---
/**
 * MagneticButton - A button that magnetically pulls toward the cursor
 * Uses spring physics for natural, satisfying movement
 */

interface Props {
  href?: string;
  download?: boolean;
  variant?: 'primary' | 'secondary';
  class?: string;
}

const { href, download, variant = 'primary', class: className } = Astro.props;

const baseClasses = 'inline-flex items-center justify-center rounded-lg px-8 py-3 text-base font-semibold transition-colors duration-300 w-full min-[480px]:w-auto';

const variantClasses = {
  primary: 'gradient-button text-background-dark',
  secondary: 'border border-white/10 bg-white/5 text-white hover:border-teal-400/50 hover:bg-white/10 hover:text-teal-400',
};

const Tag = href ? 'a' : 'button';
---

<div class="magnetic-wrapper relative inline-block w-full min-[480px]:w-auto">
  <Tag
    href={href}
    download={download ? '' : undefined}
    class:list={[baseClasses, variantClasses[variant], className]}
    data-magnetic-button
  >
    <span class="magnetic-content inline-flex items-center gap-2">
      <slot />
    </span>
  </Tag>
</div>

<style>
  .magnetic-wrapper {
    perspective: 1000px;
  }

  .magnetic-content {
    display: inline-flex;
    transition: transform 0.1s ease-out;
  }

  /* Gradient button style */
  .gradient-button {
    background: linear-gradient(to right, #2dd4bf, #38bdf8, #c084fc) !important;
    transition: filter 0.2s ease !important;
  }

  /* Glow effect on hover - disabled for gradient buttons */
  [data-magnetic-button] {
    position: relative;
    overflow: visible;
  }

  [data-magnetic-button]:not(.gradient-button)::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    background: radial-gradient(
      circle at var(--glow-x, 50%) var(--glow-y, 50%),
      rgba(56, 189, 248, 0.4) 0%,
      transparent 70%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: -1;
  }

  .magnetic-wrapper:hover [data-magnetic-button]:not(.gradient-button)::before {
    opacity: 1;
  }

  /* Reduced motion: disable magnetic movement but keep hover effects */
  @media (prefers-reduced-motion: reduce) {
    .magnetic-content {
      transition: none !important;
      transform: none !important;
    }
  }
</style>

<script>
  function initGlowButtons() {
    const wrappers = document.querySelectorAll('.magnetic-wrapper');

    wrappers.forEach((wrapper) => {
      const button = wrapper.querySelector('[data-magnetic-button]') as HTMLElement;
      if (!button) return;

      function handleMouseMove(e: MouseEvent) {
        const rect = button.getBoundingClientRect();
        const glowX = ((e.clientX - rect.left) / rect.width) * 100;
        const glowY = ((e.clientY - rect.top) / rect.height) * 100;
        button.style.setProperty('--glow-x', `${glowX}%`);
        button.style.setProperty('--glow-y', `${glowY}%`);
      }

      button.addEventListener('mousemove', handleMouseMove, { passive: true });
    });
  }

  // Initialize on load
  initGlowButtons();

  // Re-initialize after view transitions
  document.addEventListener('astro:after-swap', initGlowButtons);
</script>
